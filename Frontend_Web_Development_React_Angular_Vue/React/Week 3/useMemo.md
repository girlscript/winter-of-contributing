# useMemo

## Introduction (```Memoization```)

**Memoization** - It is an optimizing technique primarily used to speed the computer programs by storing the results of expensive **function calls** and returning the stored or cached result at a time when similar input is required. This ensures, for the same input encountered before we go through that function call again, saving memory allocation to perform that operation again.

Example:
A simple recursive program for generating a number at a given position in the Fibonacci series:

```javascript
// program to display fibonacci sequence using recursion
function rec_fib(n) {
    if(n < 2) {
        return n;
    }
    else {
        return fibonacci(n-1) + fibonacci(n-2);
    }
}

const n = prompt("Enter the term number of the fibonacci series")
if(n<0) {
    console.log("Enter a positive value")
} else {
    console.log(rec_fib(n))
}
```

The above program would work fine but for larger values of n, the recursion function call in the stack would grow so large that the memory might overflow.

So to solve the above problem we use **memoization**, i.e, we store the values of every term in an object cache  with a key (**n**) value (**fib(n)**) pair value, and if later in the recursion function call stack tree we encounter the same term we could return just by looking up the value for that value of n in the cache.

```javascript
const memo = () => {
    let memo = {}
    return function rec_fib(n) {
        //Looking for key n in memo
        if(n in memo)
            return memo[n]
        else {
            if(n<2) {
                memo[n]=n
            } else {
                //recursively calculating the value of memo[n]
                memo[n] = rec_fib(n-1) + rec_fib(n-2)
            }
            return memo[n];//Returning the value of n in memo
        }
    }
}
```

The above program would take fewer recursive calls as compared to a simple recursive program for a Fibonacci number this is because of memoization.

So let us look more about one of React hooks - **useMemo**

## What is ```useMemo```?

One of the React useHooks, ```usememo``` is the one that returns **memoized** values. It takes in an expensive function call and certain parameters on which the output generated by the function call depends or in short known as dependencies. It only calculates the value of the function when any one of the dependencies has changed.

The syntax for useMemo:

```js
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
```

## Why use ```useMemo```?

Consider a situation where one of the components re-renders and every time a function is called irrespective of whether the values on which it depends has changed or not. For simple functions, this would not have that much effect on re-rendering time, but as the complexity of the function grows we cannot afford each time to calculate that function value if the input parameter doesn't change.

In such a situation we tend to put that expensive function call in the useMemo hook, which only runs that function only when the input parameters have changed. While re-rendering the component to calculate that function call we could look up in the cache for that value as useMemo stores the function returned value in a cache. This helps in reducing the re-rendering time for the component.

Example:

```jsx
import React, { useState } from 'react';
import ReactDOM from 'react-dom';

function App() {
  // State for num1, num2 and counter
  const [count, setCount] = useState(0)
  const [divCount, setDivCount] = useState(0)

  //Expensive operation performed
  const performExpensiveOperation = (divCount) => {
    let i=0, result=0;
    while(i<10000000) {
        result+=i;
        i++
    }
    return result
  }

  const result = performExpensiveOperation(divCount);

  return (
    <>
      <div onClick={() => setDivCount(divCount + 1)}>
        Div element
      </div>
      <div>Div click count: {divCount}</div>
      <br />
      <button onClick={() => setCount(buttonClickCount + 1)}>
        Button element
      </button>
      <div>Button click count: {count}</div>
      <br />
      <div>Result: {result}</div>
    </>
  );
}
```

In the above example you can see there is an expensive operation performed even when we click the button element also re-renders the button thus triggering to change the state of divCount and this makes the app slower noticeably.

To optimize this we could just put the **performExpensiveOperation()** in the ```useMemo``` hook and it would just run only when the divCount changes.

Optimized code using ```useMemo``` hook:

```jsx
import React, { useState } from 'react';
import ReactDOM from 'react-dom';

function App() {
  // State for num1, num2 and counter
  const [count, setCount] = useState(0)
  const [divCount, setDivCount] = useState(0)

  //Expensive operation performed
  const performExpensiveOperation = (divCount) => {
    let i=0, result=0;
    while(i<10000000) {
        result+=i;
        i++
    }
    return result
  }

  //using useMemo hook to calculate the value of performExpensiveOperation
  //only when the divCount value changes 
  const result = useMemo(() => performExpensiveOperation(divCount), [divCount]);

  return (
    <>
      <div onClick={() => setDivCount(divCount + 1)}>
        Div element
      </div>
      <div>Div click count: {divCount}</div>
      <br />
      <button onClick={() => setCount(buttonClickCount + 1)}>
        Button element
      </button>
      <div>Button click count: {count}</div>
      <br />
      <div>Result: {result}</div>
    </>
  );
}
```

## Advantages of ```useMemo```

1. The ```useMemo``` hook helps to increase the performance of an application by remembering the result of the expensive function calculation or storing the result in a cache and not running it again with the same parameters.

2. With the help of ```useMemo``` you cannot just only **memoize** the value of the function call but also for any value type unlike ```useCallback```

### References

1. [Memoization](https://www.section.io/engineering-education/an-introduction-to-memoization-in-javascript/)

2. [GeeksforGeeks useMemo](https://www.geeksforgeeks.org/react-js-usememo-hook/)

3. [DigitalOcean useMemo](https://www.digitalocean.com/community/tutorials/react-usememo)